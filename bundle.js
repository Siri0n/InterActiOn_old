(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";

//var Phaser = require("phaser");

var game = new Phaser.Game(800, 600, Phaser.AUTO, '');

game.state.add("game", function () {
	var data;
	return {
		init: function init(data_) {
			data = data_;
		},
		preload: function preload() {
			game.load.image("cell", "assets/cell.png");
			game.load.start();
		},
		create: function create() {
			var main = new Game({ game: game, data: data, rect: new Phaser.Rectangle(0, 0, game.width, game.height) });
		}
	};
}());

game.state.start("game", false, false, { width: 6, height: 6 });

function Game(_ref) {
	var game = _ref.game;
	var data = _ref.data;
	var rect = _ref.rect;

	var g = game.add.group();
	var field = new Field({ game: game, group: g, data: data });
	var scale = Math.min(rect.width / field.width, rect.height / field.height);
	g.scale.x = g.scale.y = scale;
	g.x = rect.x + (rect.width - field.width * scale) / 2;
	g.y = rect.y + (rect.height - field.height * scale) / 2;

	field.generateTokens();
}

function Field(_ref2) {
	var game = _ref2.game;
	var group = _ref2.group;
	var data = _ref2.data;

	var self = this;
	var background = game.add.group();
	var img = game.cache.getImage("cell");
	var w = this.tileWidth = img.width;
	var h = this.tileHeight = img.height;
	this.width = w * data.width;
	this.height = h * data.height;
	group.add(background);
	for (var i = 0; i < data.height; i++) {
		for (var j = 0; j < data.width; j++) {
			background.add(game.make.image(this.tileWidth * j, this.tileHeight * i, "cell"));
		}
	}

	var tokensLayer = game.add.group();
	group.add(tokensLayer);

	var tokens;

	this.generateTokens = function () {
		tokens = [];
		for (var _i = 0; _i < data.height; _i++) {
			for (var _j = 0; _j < data.width; _j++) {
				tokens.push(new Token({
					game: game,
					group: tokensLayer,
					data: {
						x: _j,
						y: _i,
						type: game.rnd.pick(["red", "green"])
					},
					grid: { h: h, w: w },
					events: {
						click: this.click
					}
				}));
			}
		}
	};

	this.rotate = function (clockwise) {
		if (clockwise) {
			tokens.forEach(function (token) {
				var _token$position = token.position();

				var x = _token$position.x;
				var y = _token$position.y;

				token.moveTo({ x: data.width - y - 1, y: x }, 500);
			});
		} else {
			//stub
		}
	};
	this.click = function (token) {
		self.rotate(true);
	};
}

var colors = {
	green: 0x11ff11,
	red: 0xff1111
};

function Token(_ref3) {
	var game = _ref3.game;
	var group = _ref3.group;
	var data = _ref3.data;
	var grid = _ref3.grid;
	var events = _ref3.events;

	var self = this;

	var h = grid.h;
	var w = grid.w;
	var x = data.x;
	var y = data.y;
	var value = data.value;
	var type = data.type;

	var g = game.make.graphics(x * w, y * h);
	group.add(g);

	g.lineStyle(3, 0, 1);
	g.beginFill(colors[type], 1);
	g.drawCircle(w / 2, h / 2, w / 2);
	g.endFill();

	g.inputEnabled = true;
	g.events.onInputDown.add(function () {
		events.click(self);
	});

	this.position = function () {
		return { x: x, y: y };
	};
	this.moveTo = function (position, duration) {
		game.add.tween(g).to({ x: position.x * w, y: position.y * h }, duration, "Linear", true).onComplete.add(function () {
			x = position.x;
			y = position.y;
		});
	};
}

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJtYWluLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7OztBQ0VBLElBQUksSUFBSSxHQUFHLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLE1BQU0sQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUM7O0FBRXRELElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxBQUFDLFlBQVU7QUFDakMsS0FBSSxJQUFJLENBQUM7QUFDVCxRQUFPO0FBQ04sTUFBSSxnQkFBQyxLQUFLLEVBQUM7QUFDVixPQUFJLEdBQUcsS0FBSyxDQUFDO0dBQ2I7QUFDRCxTQUFPLHFCQUFFO0FBQ1IsT0FBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLGlCQUFpQixDQUFDLENBQUM7QUFDM0MsT0FBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztHQUNsQjtBQUNELFFBQU0sb0JBQUU7QUFDUCxPQUFJLElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxFQUFDLElBQUksRUFBSixJQUFJLEVBQUUsSUFBSSxFQUFKLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUMsQ0FBQyxDQUFDO0dBQzdGO0VBQ0QsQ0FBQTtDQUNELEVBQUcsQ0FBQyxDQUFBOztBQUVMLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEVBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFDLENBQUMsQ0FBQzs7QUFHOUQsU0FBUyxJQUFJLE9BQW9CO0tBQWxCLElBQUksUUFBSixJQUFJO0tBQUUsSUFBSSxRQUFKLElB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ekIsU0FBTyxFQUFDLENBQUMsRUFBRCxDQUFDLEVBQUUsQ0FBQyxFQUFELENBQUMsRUFBQyxDQUFDO0VBQ2QsQ0FBQTtBQUNELEtBQUksQ0FBQyxNQUFNLEdBQUcsVUFBUyxRQUFRLEVBQUUsUUFBUSxFQUFDO0FBQ3pDLE1BQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUNmLEVBQUUsQ0FBQyxFQUFDLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQyxHQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUMsR0FBQyxDQUFDLEVBQUMsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUNoRSxVQUFVLENBQUMsR0FBRyxDQUFDLFlBQVU7QUFDdkIsSUFBQyxHQUFPLFFBQVEsQ0FBaEIsQ0FBQztBQUFFLElBQUMsR0FBSSxRQUFRLENBQWIsQ0FBQztHQUNOLENBQUMsQ0FBQztFQUNKLENBQUE7Q0FFRCIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIvL3ZhciBQaGFzZXIgPSByZXF1aXJlKFwicGhhc2VyXCIpO1xyXG5cclxudmFyIGdhbWUgPSBuZXcgUGhhc2VyLkdhbWUoODAwLCA2MDAsIFBoYXNlci5BVVRPLCAnJyk7XHJcblxyXG5nYW1lLnN0YXRlLmFkZChcImdhbWVcIiwgKGZ1bmN0aW9uKCl7XHJcblx0dmFyIGRhdGE7XHJcblx0cmV0dXJuIHtcclxuXHRcdGluaXQoZGF0YV8pe1xyXG5cdFx0XHRkYXRhID0gZGF0YV87XHJcblx0XHR9LFxyXG5cdFx0cHJlbG9hZCgpe1xyXG5cdFx0XHRnYW1lLmxvYWQuaW1hZ2UoXCJjZWxsXCIsIFwiYXNzZXRzL2NlbGwucG5nXCIpO1xyXG5cdFx0XHRnYW1lLmxvYWQuc3RhcnQoKTtcclxuXHRcdH0sXHJcblx0XHRjcmVhdGUoKXtcclxuXHRcdFx0dmFyIG1haW4gPSBuZXcgR2FtZSh7Z2FtZSwgZGF0YSwgcmVjdDogbmV3IFBoYXNlci5SZWN0YW5nbGUoMCwgMCwgZ2FtZS53aWR0aCwgZ2FtZS5oZWlnaHQpfSk7XHJcblx0XHR9XHJcblx0fVxyXG59KSgpKVxyXG5cclxuZ2FtZS5zdGF0ZS5zdGFydChcImdhbWVcIiwgZmFsc2UsIGZhbHNlLCB7d2lkdGg6IDYsIGhlaWdodDogNn0pO1xyXG5cclxuXHJcbmZ1bmN0aW9uIEdhbWUoe2dhbWUsIGRhdGEsIHJlY3R9KXtcclxuXHR2YXIgZyA9IGdhbWUuYWRkLmdyb3VwKCk7XHJcblx0dmFyIGZpZWxkID0gbmV3IEZpZWxkKHtnYW1lLCBncm91cDogZywgZGF0YX0pO1xyXG5cdHZhciBzY2FsZSA9IE1hdGgubWluKHJlY3Qud2lkdGgvZmllbGQud2lkdGgsIHJlY3QuaGVpZ2h0L2ZpZWxkLmhlaWdodCk7XHJcblx0Zy5zY2FsZS54ID0gZy5zY2FsZS55ID0gc2NhbGU7XHJcblx0Zy54ID0gcmVjdC54ICsgKHJlY3Qud2lkdGggLSBmaWVsZC53aWR0aCpzY2FsZSkvMjtcclxuXHRnLnkgPSByZWN0LnkgKyAocmVjdC5oZWlnaHQgLSBmaWVsZC5oZWlnaHQqc2NhbGUpLzI7XHJcblxyXG5cdGZpZWxkLmdlbmVyYXRlVG9rZW5zKCk7XHJcbn1cclxuXHJcblxyXG5mdW5jdGlvbiBGaWVsZCh7Z2FtZSwgZ3JvdXAsIGRhdGF9KXtcclxuXHR2YXIgc2VsZiA9IHRoaXM7XHJcblx0dmFyIGJhY2tncm91bmQgPSBnYW1lLmFkZC5ncm91cCgpO1xyXG5cdHZhciBpbWcgPSBnYW1lLmNhY2hlLmdldEltYWdlKFwiY2VsbFwiKTtcclxuXHR2YXIgdyA9IHRoaXMudGlsZVdpZHRoID0gaW1nLndpZHRoO1xyXG5cdHZhciBoID0gdGhpcy50aWxlSGVpZ2h0ID0gaW1nLmhlaWdodDtcclxuXHR0aGlzLndpZHRoID0gdypkYXRhLndpZHRoO1xyXG5cdHRoaXMuaGVpZ2h0ID0gaCpkYXRhLmhlaWdodDtcclxuXHRncm91cC5hZGQoYmFja2dyb3VuZCk7XHJcblx0Zm9yKGxldCBpID0gMDsgaSA8IGRhdGEuaGVpZ2h0OyBpKyspe1xyXG5cdFx0Zm9yKGxldCBqID0gMDsgaiA8IGRhdGEud2lkdGg7IGorKyl7XHJcblx0XHRcdGJhY2tncm91bmQuYWRkKFxyXG5cdFx0XHRcdGdhbWUubWFrZS5pbWFnZSh0aGlzLnRpbGVXaWR0aCpqLCB0aGlzLnRpbGVIZWlnaHQqaSwgXCJjZWxsXCIpXHJcblx0XHRcdCk7XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdHZhciB0b2tlbnNMYXllciA9IGdhbWUuYWRkLmdyb3VwKCk7XHJcblx0Z3JvdXAuYWRkKHRva2Vuc0xheWVyKTtcclxuXHRcclxuXHR2YXIgdG9rZW5zO1xyXG5cdFxyXG5cdHRoaXMuZ2VuZXJhdGVUb2tlbnMgPSBmdW5jdGlvbigpe1xyXG5cdFx0dG9rZW5zID0gW107XHJcblx0XHRmb3IobGV0IGkgPSAwOyBpIDwgZGF0YS5oZWlnaHQ7IGkrKyl7XHJcblx0XHRcdGZvcihsZXQgaiA9IDA7IGogPCBkYXRhLndpZHRoOyBqKyspe1xyXG5cdFx0XHRcdHRva2Vucy5wdXNoKFxyXG5cdFx0XHRcdFx0bmV3IFRva2VuKHtcclxuXHRcdFx0XHRcdFx0Z2FtZSwgXHJcblx0XHRcdFx0XHRcdGdyb3VwOiB0b2tlbnNMYXllciwgXHJcblx0XHRcdFx0XHRcdGRhdGE6IHtcclxuXHRcdFx0XHRcdFx0XHR4OiBqLFxyXG5cdFx0XHRcdFx0XHRcdHk6IGksXHJcblx0XHRcdFx0XHRcdFx0dHlwZTogZ2FtZS5ybmQucGljayhbXHJcblx0XHRcdFx0XHRcdFx0XHRcInJlZFwiLFxyXG5cdFx0XHRcdFx0XHRcdFx0XCJncmVlblwiXHJcblx0XHRcdFx0XHRcdFx0XSlcclxuXHRcdFx0XHRcdFx0fSxcclxuXHRcdFx0XHRcdFx0Z3JpZDoge2gsIHd9LFxyXG5cdFx0XHRcdFx0XHRldmVudHM6IHtcclxuXHRcdFx0XHRcdFx0XHRjbGljazogdGhpcy5jbGlja1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9KVxyXG5cdFx0XHRcdCk7XHJcblx0XHRcdH1cclxuXHRcdH1cdFxyXG5cdH1cclxuXHJcblx0dGhpcy5yb3RhdGUgPSBmdW5jdGlvbihjbG9ja3dpc2Upe1xyXG5cdFx0aWYoY2xvY2t3aXNlKXtcclxuXHRcdFx0dG9rZW5zLmZvckVhY2goZnVuY3Rpb24odG9rZW4pe1xyXG5cdFx0XHRcdHZhciB7eCwgeX0gPSB0b2tlbi5wb3NpdGlvbigpO1xyXG5cdFx0XHRcdHRva2VuLm1vdmVUbyh7eDogZGF0YS53aWR0aCAtIHkgLSAxLCB5OiB4fSwgNTAwKTtcclxuXHRcdFx0fSlcclxuXHRcdH1lbHNle1xyXG5cdFx0XHQvL3N0dWJcclxuXHRcdH1cclxuXHR9XHJcblx0dGhpcy5jbGljayA9IGZ1bmN0aW9uKHRva2VuKXtcclxuXHRcdHNlbGYucm90YXRlKHRydWUpO1xyXG5cdH1cclxufVxyXG5cclxudmFyIGNvbG9ycyA9IHtcclxuXHRncmVlbjogMHgxMWZmMTEsXHJcblx0cmVkOiAweGZmMTExMVxyXG59XHJcblxyXG5mdW5jdGlvbiBUb2tlbih7Z2FtZSwgZ3JvdXAsIGRhdGEsIGdyaWQsIGV2ZW50c30pe1xyXG5cdHZhciBzZWxmID0gdGhpcztcclxuXHRcclxuXHR2YXIge2gsIHd9ID0gZ3JpZDtcclxuXHR2YXIge3gsIHksIHZhbHVlLCB0eXBlfSA9IGRhdGE7XHJcblx0XHJcblx0dmFyIGcgPSBnYW1lLm1ha2UuZ3JhcGhpY3MoeCp3LCB5KmgpO1xyXG5cdGdyb3VwLmFkZChnKTtcclxuXHRcclxuXHRnLmxpbmVTdHlsZSgzLCAwLCAxKTtcclxuXHRnLmJlZ2luRmlsbChjb2xvcnNbdHlwZV0sIDEpO1xyXG5cdGcuZHJhd0NpcmNsZSh3LzIsIGgvMiwgdy8yKTtcclxuXHRnLmVuZEZpbGwoKTtcclxuXHJcblx0XHJcblx0Zy5pbnB1dEVuYWJsZWQgPSB0cnVlO1xyXG5cdGcuZXZlbnRzLm9uSW5wdXREb3duLmFkZChmdW5jdGlvbigpe1xyXG5cdFx0ZXZlbnRzLmNsaWNrKHNlbGYpO1xyXG5cdH0pO1xyXG5cdFxyXG5cdHRoaXMucG9zaXRpb24gPSBmdW5jdGlvbigpe1xyXG5cdFx0cmV0dXJuIHt4LCB5fTtcclxuXHR9XHJcblx0dGhpcy5tb3ZlVG8gPSBmdW5jdGlvbihwb3NpdGlvbiwgZHVyYXRpb24pe1xyXG5cdFx0Z2FtZS5hZGQudHdlZW4oZylcclxuXHRcdFx0LnRvKHt4OiBwb3NpdGlvbi54KncsIHk6IHBvc2l0aW9uLnkqaH0sIGR1cmF0aW9uLCBcIkxpbmVhclwiLCB0cnVlKVxyXG5cdFx0XHQub25Db21wbGV0ZS5hZGQoZnVuY3Rpb24oKXtcclxuXHRcdFx0XHQoe3gsIHl9ID0gcG9zaXRpb24pO1xyXG5cdFx0XHR9KTtcclxuXHR9XHJcblx0XHJcbn0iXX0=
